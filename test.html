<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mapa Astrológico — Header</title>
<style>
  :root{
    --header-h: 120px;
    --sign-gap: 1px;
    --max-planet: 80; /* px for largest (Sun) desktop */
  }
  body{
    margin:0;
    background:#000;
    color:#fff;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
  }

  .astro-header{
    width:100%;
    max-width:1400px;
    height:var(--header-h);
    display:grid;
    grid-template-columns:repeat(12,1fr);
    gap:var(--sign-gap);
    border-radius:8px;
    overflow:hidden;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow:0 6px 30px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  }

  .sign {
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    background: rgba(255,255,255,0.01);
    border-right:1px solid rgba(255,255,255,0.01);
    min-width:0;
  }

  .sign .label {
    position:absolute;
    left:8px;
    top:6px;
    font-size:11px;
    opacity:0.6;
    pointer-events:none;
    text-transform:uppercase;
    letter-spacing:0.06em;
  }

  .planet {
    position:absolute;
    transform: translateY(6px);
    border-radius:50%;
    box-shadow:0 6px 18px rgba(0,0,0,0.5), inset -6px -8px 12px rgba(0,0,0,0.35);
    transition: all 800ms cubic-bezier(.2,.9,.2,1);
    display:flex;
    align-items:center;
    justify-content:center;
    color:transparent;
    user-select:none;
    pointer-events:none;
  }

  .planet[data-layer="0"]{ z-index:20; }
  .planet[data-layer="9"]{ z-index:1; }

  @media (max-width:420px){
    :root{ --header-h: 90px; --max-planet: 56; }
  }
  @media (min-width:1024px){
    :root{ --header-h: 140px; --max-planet: 90; }
  }

  /* Visual styles */
  .planet.sun {
    background: radial-gradient(circle at 30% 30%, #fff6b0 0%, #ffd54f 40%, #ff8f00 70%, #ff6f00 100%);
    box-shadow:
      0 0 calc(var(--shadow,40px)) rgba(255,160,50,0.75),
      0 6px 18px rgba(0,0,0,0.45);
    filter:brightness(1.05) saturate(1.1);
  }
  .planet.moon {
    background-image:
      radial-gradient(circle at 30% 30%, #ffffff 0%, #e0e0e0 60%, #999999 100%),
      radial-gradient(circle at 20% 40%, rgba(150,150,150,0.25) 2px, transparent 3px);
    box-shadow: 0 0 18px rgba(255,255,255,0.65), inset -6px -6px 12px rgba(0,0,0,0.35);
  }
  .planet.mercury{
    background: radial-gradient(circle at 30% 30%, #cfc4b2 0%, #a29b8a 40%, #5e564b 100%);
  }
  .planet.venus{
    background: linear-gradient(135deg,#f8eab0 0%, #f3c677 40%, #b77f30 100%);
    filter:brightness(1.05);
  }
  .planet.mars{
    background: radial-gradient(circle at 35% 35%, #ffb080 0%, #d84315 60%, #7f1d1d 100%);
    box-shadow: 0 0 14px rgba(255,80,50,0.35);
  }
  .planet.jupiter{
    background: repeating-linear-gradient(10deg,#f8e0b0 0%,#e0b080 8%,#d7a071 16%,#c48f65 24%,#f0d0a0 32%);
    box-shadow: inset -6px -6px 12px rgba(0,0,0,0.35);
  }
  .planet.jupiter .storm {
    position:absolute;
    border-radius:50% / 60%;
    background: radial-gradient(circle at 40% 40%, #ff7640 0%, #b33515 60%, rgba(80,20,0,0.85) 100%);
    filter: blur(0.4px);
    box-shadow:0 0 6px rgba(255,100,50,0.6);
  }
  .planet.saturn { background: radial-gradient(circle at 40% 40%, #f8e8b0 0%, #d6b25f 60%, #9b7b3a 100%); }
  .rings {
    position:absolute;
    pointer-events:none;
    border-radius:50%;
    transform: rotateX(62deg) rotateZ(25deg);
    filter: blur(0.6px);
    mix-blend-mode:screen;
  }
  .planet.uranus { background: radial-gradient(circle at 30% 30%, #a0e8f8 0%, #70c8e0 60%, #458ab0 100%); box-shadow: inset -4px -4px 8px rgba(0,0,0,0.25); }
  .planet.neptune { background: radial-gradient(circle at 30% 30%, #4ab0ff 0%, #2850a0 60%, #1a237e 100%); }
  .planet.pluto { background: radial-gradient(circle at 30% 30%, #d9c9b0 0%, #a0886f 60%, #6b5a4a 100%); box-shadow: inset -3px -3px 6px rgba(0,0,0,0.35); }

  .planet .tag {
    position:absolute;
    bottom:-22px;
    left:50%;
    transform:translateX(-50%);
    font-size:11px;
    padding:3px 6px;
    background: rgba(255,255,255,0.06);
    border-radius:4px;
    color:#fff;
    opacity:0.9;
    pointer-events:none;
    white-space:nowrap;
    font-weight:600;
  }

  .placeholder { opacity:0.02; pointer-events:none; }

</style>
</head>
<body>

  <div class="astro-header" id="astroHeader" aria-hidden="false">
    <!-- signs will be inserted by JS -->
  </div>

<script>
/* Zodiac and bodies config */
const SIGNS = [
  'Aries','Tauro','Géminis','Cáncer','Leo','Virgo',
  'Libra','Escorpio','Sagitario','Capricornio','Acuario','Piscis'
];

const BODIES = [
  { id:'sun', label:'Sol', maxSizeFactor:1.00, cssClass:'sun' },
  { id:'moon', label:'Luna', maxSizeFactor:0.75, cssClass:'moon' },
  { id:'mercury', label:'Mercurio', maxSizeFactor:0.44, cssClass:'mercury' },
  { id:'venus', label:'Venus', maxSizeFactor:0.68, cssClass:'venus' },
  { id:'mars', label:'Marte', maxSizeFactor:0.5, cssClass:'mars' },
  { id:'jupiter', label:'Júpiter', maxSizeFactor:0.88, cssClass:'jupiter' },
  { id:'saturn', label:'Saturno', maxSizeFactor:0.75, cssClass:'saturn' },
  { id:'uranus', label:'Urano', maxSizeFactor:0.68, cssClass:'uranus' },
  { id:'neptune', label:'Neptuno', maxSizeFactor:0.65, cssClass:'neptune' },
  { id:'pluto', label:'Plutón', maxSizeFactor:0.35, cssClass:'pluto' }
];

/* Build header grid */
const header = document.getElementById('astroHeader');
SIGNS.forEach((s, idx) => {
  const div = document.createElement('div');
  div.className = 'sign';
  div.dataset.sign = s;
  div.dataset.index = idx;
  const lab = document.createElement('div');
  lab.className = 'label';
  lab.textContent = s;
  div.appendChild(lab);
  const ph = document.createElement('div');
  ph.className = 'placeholder';
  div.appendChild(ph);
  header.appendChild(div);
});

/* Helpers */
function getMaxPlanetPx(){
  return parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--max-planet')) || 80;
}
function lonToSign(lon){
  let L = ((lon % 360) + 360) % 360;
  return Math.floor(L / 30);
}

/* Approximate orbital periods (days) for fallback mean motion */
const PERIOD_DAYS = {
  sun: 365.256, moon: 27.32166,
  mercury: 87.969, venus: 224.701,
  mars: 686.98, jupiter: 4332.589, saturn: 10759.22,
  uranus: 30688.5, neptune: 60182, pluto: 90560
};

/* Epoch for simple mean longitude calc: J2000.0 */
const EPOCH = new Date('2000-01-01T12:00:00Z');

/* Return approximate ecliptic longitude (deg 0..360) using simple mean motion */
function approxLongitude(bodyId, date){
  const msPerDay = 1000 * 60 * 60 * 24;
  const days = (date - EPOCH) / msPerDay;
  // base offsets (deg) chosen so Sun near 280 on epoch; others arbitrary but produce variation
  const baseOffsets = {
    sun: 280.460, moon: 218.316,
    mercury: 252.251, venus: 181.979, mars: 355.433,
    jupiter: 34.404, saturn: 50.077, uranus: 314.055, neptune: 304.348, pluto: 238.929
  };
  const period = PERIOD_DAYS[bodyId] || 365.25;
  const meanMotion = 360 / period; // deg per day
  const lon = (baseOffsets[bodyId] + meanMotion * days) % 360;
  return ((lon + 360) % 360);
}

/* Try to fetch positions (non-blocking); if fails, fallback to approxLongitude */
async function getPositions(date){
  // Attempt to use an external API (CORS may block); we will attempt but fall back on failure
  // We avoid throwing errors so UI remains responsive
  try {
    // Example: attempt to call ephemeris API (this may fail due to CORS)
    // This block is intentionally conservative: if fetch fails, we go to fallback.
    const iso = date.toISOString();
    // Placeholder URL commented because API availability varies; we skip network by default.
    // const res = await fetch(`https://api.example/positions?date=${encodeURIComponent(iso)}`);
    // if (res.ok){ const data = await res.json(); return parseApiPositions(data); }
    // Directly return fallback for reliable local behavior:
    throw new Error('Skipping network fetch; using local fallback.');
  } catch (e) {
    const pos = {};
    for (const b of BODIES){
      pos[b.id] = { lon: approxLongitude(b.id, date) };
    }
    return pos;
  }
}

/* Create planet element */
function makePlanetEl(body, sizePx, lon){
  const el = document.createElement('div');
  el.className = `planet ${body.cssClass}`;
  el.dataset.body = body.id;
  el.style.width = `${sizePx}px`;
  el.style.height = `${sizePx}px`;
  el.style.setProperty('--size', `${sizePx}px`);
  el.style.setProperty('--shadow', `${Math.max(24, sizePx * 0.5)}px`);
  // layering: smaller elements in front => higher z-index (compute layer 0..9)
  const layer = Math.round((1 - body.maxSizeFactor) * 9);
  el.dataset.layer = layer;
  // show label tag
  const tag = document.createElement('div');
  tag.className = 'tag';
  tag.textContent = body.label;
  el.appendChild(tag);
  // optionally add Jupiter storm
  if (body.id === 'jupiter'){
    const storm = document.createElement('div');
    storm.className = 'storm';
    // size relative to planet
    const stormW = Math.max(8, Math.round(sizePx * 0.28));
    const stormH = Math.max(5, Math.round(sizePx * 0.16));
    storm.style.width = `${stormW}px`;
    storm.style.height = `${stormH}px`;
    el.appendChild(storm);
  }
  // Saturn ring container (visual only)
  if (body.id === 'saturn'){
    const rings = document.createElement('div');
    rings.className = 'rings';
    // ring sizing based on planet size
    const ringW = Math.round(sizePx * 4.2);
    const ringH = Math.round(sizePx * 1.2);
    rings.style.width = `${ringW}px`;
    rings.style.height = `${ringH}px`;
    rings.style.left = `50%`;
    rings.style.top = `50%`;
    rings.style.transform = `translate(-50%,-50%) rotateX(62deg) rotateZ(25deg)`;
    rings.style.opacity = 0.95;
    el.appendChild(rings);
  }
  return el;
}

/* Place planets into sign columns */
async function placePlanets(date = new Date()){
  const positions = await getPositions(date);
  // clear existing planets from signs
  document.querySelectorAll('.sign').forEach(s => {
    // remove appended planet nodes, keep label & placeholder
    Array.from(s.children).forEach(child => {
      if (child.classList && child.classList.contains('planet')) child.remove();
    });
  });

  const maxPx = getMaxPlanetPx();
  for (const body of BODIES){
    const pos = positions[body.id];
    if (!pos) continue;
    const signIdx = lonToSign(pos.lon);
    const signEl = document.querySelector(`.sign[data-index="${signIdx}"]`);
    if (!signEl) continue;
    const sizePx = Math.max(6, Math.round(maxPx * body.maxSizeFactor));
    const planetEl = makePlanetEl(body, sizePx, pos.lon);

    // horizontal offset inside sign: map exact longitude inside the 30° sign to x offset
    const signStart = signIdx * 30;
    const offsetDeg = ((pos.lon - signStart) + 360) % 30; // 0..30
    const pct = offsetDeg / 30; // 0..1
    // compute left position inside sign element
    planetEl.style.left = `calc(${pct * 100}% )`;
    planetEl.style.top = `50%`;
    planetEl.style.transform = `translate(-50%,-50%)`;

    // append and allow CSS transitions to animate
    signEl.appendChild(planetEl);
  }
}

/* Initial render and periodic update */
async function initAstro(){
  await placePlanets(new Date());
  // update every 60s to keep in sync
  setInterval(() => placePlanets(new Date()), 60 * 1000);
}
initAstro();

</script>
</body>
</html>
